// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String       @id @default(uuid())
  name              String
  email             String       @unique
  password          String       // Hashed password
  role              String       @default("User") // 'Admin' | 'User'
  mustChangePassword Boolean     @default(false)
  lastLogin         DateTime?
  createdAt         DateTime     @default(now())
  
  // Relations
  assignedActions ActionItem[] @relation("ResponsiblePerson")
  createdActions  ActionItem[] @relation("CreatedBy")
  createdNotes    Note[]
  auditLogs       AuditLog[]
}

model ActionItem {
  id                   String    @id @default(uuid())
  title                String
  description          String?
  category             String    // 'Operational' | 'Strategic' | 'Admin'
  priority             String    // 'High' | 'Medium' | 'Low'
  status               String    @default("Not Started") // 'Not Started' | 'Ongoing' | 'Completed' | 'Delayed' | 'Paused'
  
  meetingDate          DateTime
  targetCompletionDate DateTime?
  
  responsiblePersonId  String
  responsiblePerson    User      @relation("ResponsiblePerson", fields: [responsiblePersonId], references: [id])
  
  createdById          String
  createdBy            User      @relation("CreatedBy", fields: [createdById], references: [id])
  
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  
  notes                Note[]
  auditLogs            AuditLog[]
}

model Note {
  id           String     @id @default(uuid())
  content      String
  actionItemId String
  actionItem   ActionItem @relation(fields: [actionItemId], references: [id], onDelete: Cascade)
  
  createdById  String
  createdBy    User       @relation(fields: [createdById], references: [id])
  
  createdAt    DateTime   @default(now())
}

model AuditLog {
  id           String     @id @default(uuid())
  actionItemId String
  actionItem   ActionItem @relation(fields: [actionItemId], references: [id])
  
  changedField String
  oldValue     String?
  newValue     String?
  
  changedById  String
  changedBy    User       @relation(fields: [changedById], references: [id])
  
  changedAt    DateTime   @default(now())
}
